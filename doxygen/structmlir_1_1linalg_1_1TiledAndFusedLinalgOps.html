<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MLIR: mlir::linalg::TiledAndFusedLinalgOps Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MLIR
   &#160;<span id="projectnumber">15.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacemlir.html">mlir</a></li><li class="navelem"><a class="el" href="namespacemlir_1_1linalg.html">linalg</a></li><li class="navelem"><a class="el" href="structmlir_1_1linalg_1_1TiledAndFusedLinalgOps.html">TiledAndFusedLinalgOps</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="structmlir_1_1linalg_1_1TiledAndFusedLinalgOps-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">mlir::linalg::TiledAndFusedLinalgOps Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Fuse a sequence of linalg operations (<code>ops</code>) using tile-and-fuse.  
 <a href="structmlir_1_1linalg_1_1TiledAndFusedLinalgOps.html#details">More...</a></p>

<p><code>#include &quot;<a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html">mlir/Dialect/Linalg/Transforms/Transforms.h</a>&quot;</code></p>
<div class="dynheader">
Collaboration diagram for mlir::linalg::TiledAndFusedLinalgOps:</div>
<div class="dyncontent">
<div class="center"><img src="structmlir_1_1linalg_1_1TiledAndFusedLinalgOps__coll__graph.png" border="0" usemap="#mlir_1_1linalg_1_1TiledAndFusedLinalgOps_coll__map" alt="Collaboration graph"/></div>
<map name="mlir_1_1linalg_1_1TiledAndFusedLinalgOps_coll__map" id="mlir_1_1linalg_1_1TiledAndFusedLinalgOps_coll__map">
<area shape="rect" id="node2" href="classllvm_1_1SmallVector.html" title="llvm::SmallVector\&lt;\l mlir::Operation *, 4 \&gt;" alt="" coords="361,5,528,47"/>
<area shape="rect" id="node3" href="classllvm_1_1SmallVector.html" title="llvm::SmallVector\&lt;\l T, N \&gt;" alt="" coords="5,39,153,80"/>
<area shape="rect" id="node6" href="classllvm_1_1SmallVector.html" title="llvm::SmallVector\&lt;\l LinalgOp, 1 \&gt;" alt="" coords="371,71,519,112"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a9cf6548f28d7202b97c0816963f2e792"><td class="memItemLeft" align="right" valign="top">LinalgOp&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmlir_1_1linalg_1_1TiledAndFusedLinalgOps.html#a9cf6548f28d7202b97c0816963f2e792">op</a></td></tr>
<tr class="memdesc:a9cf6548f28d7202b97c0816963f2e792"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classmlir_1_1Operation.html" title="Operation is a basic unit of execution within MLIR. ">Operation</a> obtained by tiling the last operation in sequence of <code>ops</code> passed to <code>tileAndFuseLinalgOps</code>.  <a href="#a9cf6548f28d7202b97c0816963f2e792">More...</a><br /></td></tr>
<tr class="separator:a9cf6548f28d7202b97c0816963f2e792"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add9995be3752631cc7aca0f91a0cfe7b"><td class="memItemLeft" align="right" valign="top">std::set&lt; <a class="el" href="classunsigned.html">unsigned</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmlir_1_1linalg_1_1TiledAndFusedLinalgOps.html#add9995be3752631cc7aca0f91a0cfe7b">fusedLoopDims</a></td></tr>
<tr class="memdesc:add9995be3752631cc7aca0f91a0cfe7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The dimension of the loops that are fused.  <a href="#add9995be3752631cc7aca0f91a0cfe7b">More...</a><br /></td></tr>
<tr class="separator:add9995be3752631cc7aca0f91a0cfe7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a37dcf634bd5e85383bef7f7c852cb9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classllvm_1_1SmallVector.html">SmallVector</a>&lt; LinalgOp, 1 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmlir_1_1linalg_1_1TiledAndFusedLinalgOps.html#a3a37dcf634bd5e85383bef7f7c852cb9">fusedProducers</a></td></tr>
<tr class="memdesc:a3a37dcf634bd5e85383bef7f7c852cb9"><td class="mdescLeft">&#160;</td><td class="mdescRight">The generated fused operations (created within the fused loops).  <a href="#a3a37dcf634bd5e85383bef7f7c852cb9">More...</a><br /></td></tr>
<tr class="separator:a3a37dcf634bd5e85383bef7f7c852cb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01cd9c06424e5b65e9f2e2b8abf8b021"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classllvm_1_1SmallVector.html">SmallVector</a>&lt; <a class="el" href="classmlir_1_1Operation.html">Operation</a> *, 4 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmlir_1_1linalg_1_1TiledAndFusedLinalgOps.html#a01cd9c06424e5b65e9f2e2b8abf8b021">fusedLoops</a></td></tr>
<tr class="memdesc:a01cd9c06424e5b65e9f2e2b8abf8b021"><td class="mdescLeft">&#160;</td><td class="mdescRight">The fused loop generated.  <a href="#a01cd9c06424e5b65e9f2e2b8abf8b021">More...</a><br /></td></tr>
<tr class="separator:a01cd9c06424e5b65e9f2e2b8abf8b021"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Fuse a sequence of linalg operations (<code>ops</code>) using tile-and-fuse. </p>
<p>This proceeds as follows:</p><ul>
<li>Find outer parallel loops in these ops that can be fused.</li>
<li><a class="el" href="structmlir_1_1linalg_1_1Tile.html" title="Represent one application of LinalgStrategyTilePass. ">Tile</a> fusable outer parallel loops of the last operation in the sequence.</li>
<li>Fuse the remaining operations with the tiled operation</li>
</ul>
<p>For example, consider the sequence of matmul below</p>
<p>linalg.matmul ins(arg0, arg1 : memref&lt;256x32xf32&gt;, memref&lt;32x32xf32&gt;) outs(arg2 : memref&lt;256x32xf32&gt;) linalg.matmul ins(arg2, arg3 : memref&lt;256x32xf32&gt;, memref&lt;32x32xf32&gt;) outs(arg4 : memref&lt;256x32xf32&gt;)</p>
<p>It is legal to fuse the RAW dependence (through arg2) by only fusing the matmuls row-wise. For example, the fused computation for the above is shown below. The outer <code>scf.parallel</code> loop is the "fused" loop obtained by tiling along the rows of the matrix. The entire rows of the first matmul operation need to be computed before they can be used for the second matmul. The second matmul is further tiled (similar to normal tiling).</p>
<p>#map0 = affine_map&lt;(d0, d1)[s0] -&gt; (d0 * 32 + s0 + d1)&gt; #map1 = affine_map&lt;(d0, d1) -&gt; (d0 * 32 + d1)&gt; scf.parallel (arg5) = (c0) to (c256) step (c16) { %0 = subview arg2[arg5, 0] [16, 32] [1, 1] : memref&lt;256x32xf32&gt; to memref&lt;16x32xf32, #map0&gt; %1 = subview arg4[arg5, 0] [16, 32] [1, 1] : memref&lt;256x32xf32&gt; to memref&lt;16x32xf32, #map0&gt; %2 = subview arg0[arg5, 0] [16, 32] [1, 1] : memref&lt;256x32xf32&gt; to memref&lt;16x32xf32, #map0&gt; %3 = subview arg1[0, 0] [32, 32] [1, 1] : memref&lt;32x32xf32&gt; to memref&lt;32x32xf32, #map1&gt; %4 = subview arg3[0, 0] [32, 32] [1, 1] : memref&lt;32x32xf32&gt; to memref&lt;32x32xf32, #map1&gt; linalg.matmul ins(%2, %3 : memref&lt;16x32xf32, #map0&gt;, memref&lt;32x32xf32, #map1&gt;) outs(%0 : memref&lt;16x32xf32, #map0&gt;) linalg.matmul ins(%0, %4 : memref&lt;16x4xf32, #map0&gt;, memref&lt;4x8xf32, #map0&gt;) outs(%1 : memref&lt;16x8xf32, #map0&gt;) }</p>
<p><code>tilingOptions</code> are used to tile the corresponding operation in <code>ops</code> (the size of the former should be same as size of the latter. Based on how tile+fuse is implemented, the fused loops are generated based on the last operation in the sequence. For example, the tile sizes for the fused loops is obtained from <code>tilingOptions.back()</code>. The following tiling options are handled differently in tile+fuse (compared to tile only)</p><ul>
<li><a class="el" href="structmlir_1_1linalg_1_1Interchange.html" title="Represent one application of createLinalgStrategyInterchangePass. ">Interchange</a> of the tiling loops is not supported right now.</li>
<li>Only the fused loops are distributed. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html#l00186">186</a> of file <a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html">Transforms.h</a>.</p>
</div><h2 class="groupheader">Member Data Documentation</h2>
<a id="add9995be3752631cc7aca0f91a0cfe7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add9995be3752631cc7aca0f91a0cfe7b">&#9670;&nbsp;</a></span>fusedLoopDims</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::set&lt;<a class="el" href="classunsigned.html">unsigned</a>&gt; mlir::linalg::TiledAndFusedLinalgOps::fusedLoopDims</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The dimension of the loops that are fused. </p>

<p class="definition">Definition at line <a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html#l00191">191</a> of file <a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html">Transforms.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="Fusion_8cpp_source.html#l00819">tileAndFuseLinalgOpsImpl()</a>.</p>

</div>
</div>
<a id="a01cd9c06424e5b65e9f2e2b8abf8b021"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01cd9c06424e5b65e9f2e2b8abf8b021">&#9670;&nbsp;</a></span>fusedLoops</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classllvm_1_1SmallVector.html">SmallVector</a>&lt;<a class="el" href="classmlir_1_1Operation.html">Operation</a> *, 4&gt; mlir::linalg::TiledAndFusedLinalgOps::fusedLoops</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The fused loop generated. </p>

<p class="definition">Definition at line <a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html#l00195">195</a> of file <a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html">Transforms.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8cpp_source.html#l00352">getTiledAndFusedOpResult()</a>, and <a class="el" href="Fusion_8cpp_source.html#l00819">tileAndFuseLinalgOpsImpl()</a>.</p>

</div>
</div>
<a id="a3a37dcf634bd5e85383bef7f7c852cb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a37dcf634bd5e85383bef7f7c852cb9">&#9670;&nbsp;</a></span>fusedProducers</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classllvm_1_1SmallVector.html">SmallVector</a>&lt;LinalgOp, 1&gt; mlir::linalg::TiledAndFusedLinalgOps::fusedProducers</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The generated fused operations (created within the fused loops). </p>

<p class="definition">Definition at line <a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html#l00193">193</a> of file <a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html">Transforms.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="Fusion_8cpp_source.html#l00819">tileAndFuseLinalgOpsImpl()</a>.</p>

</div>
</div>
<a id="a9cf6548f28d7202b97c0816963f2e792"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9cf6548f28d7202b97c0816963f2e792">&#9670;&nbsp;</a></span>op</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LinalgOp mlir::linalg::TiledAndFusedLinalgOps::op</td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="classmlir_1_1Operation.html" title="Operation is a basic unit of execution within MLIR. ">Operation</a> obtained by tiling the last operation in sequence of <code>ops</code> passed to <code>tileAndFuseLinalgOps</code>. </p>

<p class="definition">Definition at line <a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html#l00189">189</a> of file <a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html">Transforms.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8cpp_source.html#l00352">getTiledAndFusedOpResult()</a>, and <a class="el" href="Fusion_8cpp_source.html#l00819">tileAndFuseLinalgOpsImpl()</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>include/mlir/Dialect/Linalg/Transforms/<a class="el" href="Dialect_2Linalg_2Transforms_2Transforms_8h_source.html">Transforms.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed May 4 2022 20:33:05 for MLIR by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
