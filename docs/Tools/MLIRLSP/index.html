<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>MLIR : Language Server Protocol - MLIR</title><meta name=description content="Multi-Level IR Compiler Framework"><meta name=generator content="Hugo 0.80.0"><link href=https://mlir.llvm.org/index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://mlir.llvm.org/docs/Tools/MLIRLSP/><link rel=stylesheet href=https://mlir.llvm.org/css/theme.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script><link rel=stylesheet href=https://mlir.llvm.org/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js></script><script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script><script src=https://mlir.llvm.org/js/bundle.js></script><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$', '$'] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    }
  });
</script><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=1"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=1"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=1"><link rel=manifest href="/site.webmanifest?v=1"><link rel=mask-icon href="/safari-pinned-tab.svg?v=1" color=#3775e0><link rel="shortcut icon" href="/favicon.ico?v=1"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#ffffff"><link rel=icon href=/favicon.svg type=image/svg+xml sizes=any><style>:root{}</style></head><body><div class=container><header><h1><div><img src=https://mlir.llvm.org//mlir-logo.png width=40px align=absmiddle>
MLIR</div></h1><p class=description>Multi-Level IR Compiler Framework</p></header><div class=global-menu><nav><ul><li class=parent><a href>Community<i class="fas fa-angle-right"></i></a><ul class=sub-menu><li class=child><a href=https://llvm.discourse.group/c/mlir/31>Forums</a></li><li class=child><a href=https://discord.gg/xS7Z362>Chat</a></li></ul></li><li><a href=/getting_started/Debugging/>Debugging Tips</a></li><li><a href=/getting_started/Faq/>FAQ</a></li><li class=parent><a href=https://github.com/llvm/llvm-project/tree/main/mlir>Source<i class="fas fa-angle-right"></i></a><ul class=sub-menu><li class=child><a href=/doxygen/>Doxygen</a></li><li class=child><a href=https://github.com/llvm/llvm-project/tree/main/mlir>GitHub</a></li></ul></li><li><a href="https://bugs.llvm.org/buglist.cgi?bug_status=__open__&list_id=177877&order=changeddate%20DESC%2Cpriority%2Cbug_severity&product=MLIR&query_format=specific">Bugs</a></li><li><a href=https://github.com/llvm/mlir-www/tree/main/website/static/LogoAssets>Logo Assets</a></li><li><a href=https://www.youtube.com/MLIRCompiler>Youtube Channel</a></li></ul></nav></div><div class=content-container><main><h1>MLIR : Language Server Protocol</h1><p><nav id=TableOfContents><ul><li><a href=#mlir-lsp-language-server--mlir-lsp-server>MLIR LSP Language Server : <code>mlir-lsp-server</code></a><ul><li><a href=#supporting-custom-dialects-and-passes>Supporting custom dialects and passes</a></li><li><a href=#features>Features</a></li><li><a href=#design>Design</a></li></ul></li><li><a href=#editor-plugins>Editor Plugins</a><ul><li><a href=#visual-studio-code>Visual Studio Code</a></li></ul></li></ul></nav><p>This document describes the tools and utilities related to supporting
<a href=https://microsoft.github.io/language-server-protocol/>LSP</a> IDE language
extensions for the MLIR textual assembly format. An LSP language extension is
generally comprised of two components; a language client and a language server.
A language client is a piece of code that interacts with the IDE that you are
using, such as VSCode. A language server acts as the backend for queries that
the client may want to perform, such as &ldquo;Find Definition&rdquo;, &ldquo;Find References&rdquo;,
etc.</p><h2 id=mlir-lsp-language-server--mlir-lsp-server>MLIR LSP Language Server : <code>mlir-lsp-server</code>&nbsp;<a class=headline-hash href=#mlir-lsp-language-server--mlir-lsp-server>¶</a></h2><p>MLIR provides an implementation of an LSP language server in the form of the
<code>mlir-lsp-server</code> tool. This tool interacts with the MLIR C++ API to support
rich language queries, such as &ldquo;Find Definition&rdquo;.</p><h3 id=supporting-custom-dialects-and-passes>Supporting custom dialects and passes&nbsp;<a class=headline-hash href=#supporting-custom-dialects-and-passes>¶</a></h3><p><code>mlir-lsp-server</code>, like many other MLIR based tools, relies on having the
appropriate dialects registered to be able to parse in the custom assembly
formats used in the textual .mlir files. The <code>mlir-lsp-server</code> found within the
main MLIR repository provides support for all of the upstream MLIR dialects and
passes. Downstream and out-of-tree users will need to provide a custom
<code>mlir-lsp-server</code> executable that registers the entities that they are
interested in. The implementation of <code>mlir-lsp-server</code> is provided as a library,
making it easy for downstream users to register their dialect/passes and simply
call into the main implementation. A simple example is shown below:</p><div class=highlight><pre class=chroma><code class=language-c++ data-lang=c++><span class=cp>#include</span> <span class=cpf>&#34;mlir/Tools/mlir-lsp-server/MlirLspServerMain.h&#34;</span><span class=cp>
</span><span class=cp></span>
<span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>)</span> <span class=p>{</span>
  <span class=n>mlir</span><span class=o>::</span><span class=n>DialectRegistry</span> <span class=n>registry</span><span class=p>;</span>
  <span class=n>registerMyDialects</span><span class=p>(</span><span class=n>registry</span><span class=p>);</span>
  <span class=n>registerMyPasses</span><span class=p>();</span>
  <span class=k>return</span> <span class=n>mlir</span><span class=o>::</span><span class=n>failed</span><span class=p>(</span><span class=n>mlir</span><span class=o>::</span><span class=n>MlirLspServerMain</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=n>registry</span><span class=p>));</span>
<span class=p>}</span>
</code></pre></div><h3 id=features>Features&nbsp;<a class=headline-hash href=#features>¶</a></h3><p>This section details a few of the features that the MLIR language server
provides. The screenshots are shown in
<a href=https://code.visualstudio.com/>VSCode</a>,
but the exact feature set available will depend on your editor client.</p><h4 id=diagnostics>Diagnostics&nbsp;<a class=headline-hash href=#diagnostics>¶</a></h4><p>The language server runs actively runs verification on the IR as you type,
showing any generate diagnostics in-place.</p><p><img src=/mlir-lsp-server/diagnostics.png alt=IMG></p><h4 id=cross-references>Cross-references&nbsp;<a class=headline-hash href=#cross-references>¶</a></h4><p>Cross references allow for navigating the use/def chains of SSA values (i.e.
operation results and block arguments),
<a href=/docs/SymbolsAndSymbolTables/>Symbols</a>,
and Blocks.</p><h5 id=find-definition>Find definition&nbsp;<a class=headline-hash href=#find-definition>¶</a></h5><p>Jump to the definition of the IR entity under the cursor. A few examples are
shown below:</p><ul><li>SSA Values</li></ul><p><img src=/mlir-lsp-server/goto_def_ssa.gif alt=SSA></p><ul><li>Symbol References</li></ul><p><img src=/mlir-lsp-server/goto_def_symbol.gif alt=Symbols></p><p>The definition of an operation will also take into account the source location
attached, allowing for navigating into the source file that generated the
operation.</p><p><img src=/mlir-lsp-server/goto_def_external.gif alt="External Locations"></p><h5 id=find-references>Find references&nbsp;<a class=headline-hash href=#find-references>¶</a></h5><p>Show all references of the IR entity under the cursor.</p><p><img src=/mlir-lsp-server/find_references.gif alt=IMG></p><h4 id=hover>Hover&nbsp;<a class=headline-hash href=#hover>¶</a></h4><p>Hover over an IR entity to see more information about it. The exact information
displayed is dependent on the type of IR entity under the cursor. For example,
hovering over an <code>Operation</code> may show its generic format.</p><p><img src=/mlir-lsp-server/hover.png alt=IMG></p><h4 id=navigation>Navigation&nbsp;<a class=headline-hash href=#navigation>¶</a></h4><p>The language server will also inform the editor about the structure of symbol
tables within the IR. This allows for jumping directly to the definition of a
symbol, such as a <code>func</code>, within the file.</p><p><img src=/mlir-lsp-server/navigation.gif alt=IMG></p><h3 id=design>Design&nbsp;<a class=headline-hash href=#design>¶</a></h3><p>The design of <code>mlir-lsp-server</code> is largely comprised of three different
components:</p><ul><li>Communication and Transport (via JSON-RPC)</li><li>Language Server Protocol</li><li>MLIR Language Server</li></ul><p><img src=/includes/img/mlir-lsp-server-server_diagram.svg alt="Index Map Example"></p><h4 id=communication-and-transport>Communication and Transport&nbsp;<a class=headline-hash href=#communication-and-transport>¶</a></h4><p><code>mlir-lsp-server</code> communicates with the language client via JSON-RPC over
stdin/stdout. In the code, this is the <code>JSONTransport</code> class. This class knows
nothing about the Language Server Protocol, it only knows that JSON-RPC messages
are coming in and JSON-RPC messages are going out. The handling of incoming and
outgoing LSP messages is left to the <code>MessageHandler</code> class. This class routes
incoming messages to handlers in the <code>Language Server Protocol</code> layer for
interpretation, and packages outgoing messages for transport. This class also
has limited knowledge of the LSP, and only has information about the three main
classes of messages: notifications, calls, and replies.</p><h4 id=language-server-protocol>Language Server Protocol&nbsp;<a class=headline-hash href=#language-server-protocol>¶</a></h4><p><code>LSPServer</code> handles the interpretation of the finer LSP details. This class
registers handlers for LSP messages and then forwards to the <code>MLIR Language Server</code> for processing. The intent of this component is to hold all of the
necessary glue when communicating from the MLIR world to the LSP world. In most
cases, the LSP message handlers simply forward to the <code>MLIR Language Server</code>. In
some cases however, the impedance mismatch between the two requires more
complicated glue code.</p><h4 id=mlir-language-server>MLIR Language Server&nbsp;<a class=headline-hash href=#mlir-language-server>¶</a></h4><p><code>MLIRServer</code> provides the internal MLIR-based implementation of all of LSP
queries. This is the class that directly interacts with the MLIR C++ API,
including parsing .mlir text files, running passes, etc.</p><h2 id=editor-plugins>Editor Plugins&nbsp;<a class=headline-hash href=#editor-plugins>¶</a></h2><p>LSP Language plugins are available for many popular editors, and in principle
<code>mlir-lsp-server</code> should work with any of them, though feature set and interface
may vary. Below are a set of plugins that are known to work:</p><h3 id=visual-studio-code>Visual Studio Code&nbsp;<a class=headline-hash href=#visual-studio-code>¶</a></h3><p>Provides
<a href=https://mlir.llvm.org/>MLIR</a> language IDE features for VS code:</p><ul><li>Syntax highlighting for .mlir files and <code>mlir</code> markdown blocks</li><li>go-to-definition and cross references</li><li>Detailed information when hovering over IR entities</li><li>Outline and navigation of symbols and symbol tables</li><li>Live parser and verifier diagnostics</li></ul><h4 id=setup>Setup&nbsp;<a class=headline-hash href=#setup>¶</a></h4><p>This extension requires the
<a href=https://mlir.llvm.org/docs/Tools/MLIRLSP/><code>mlir-lsp-server</code> language server</a>.
If not found in your path, you must specify the path of the server in the
settings of this extension.</p><h4 id=contributing>Contributing&nbsp;<a class=headline-hash href=#contributing>¶</a></h4><p>This extension is actively developed within the
<a href=https://github.com/llvm/llvm-project/tree/main/mlir/utils/vscode>LLVM monorepo</a>,
at <code>mlir/utils/vscode</code>. As such, contributions should follow the
<a href=https://llvm.org/docs/Contributing.html>normal LLVM guidelines</a>, with code
reviews sent to
<a href=https://llvm.org/docs/Contributing.html#how-to-submit-a-patch>phabricator</a>.</p><p>When developing or deploying this extension within the LLVM monorepo, a few
extra setup steps are required:</p><ul><li>Copy <code>mlir/utils/textmate/mlir.json</code> to the extension directory and rename
to <code>grammar.json</code>.</li><li>Copy
<code>https://mlir.llvm.org//LogoAssets/logo/PNG/full_color/mlir-identity-03.png</code>
to the extension directory and rename to <code>icon.png</code>.</li></ul><p>Please follow the existing code style when contributing to the extension, we
recommend to run <code>npm run format</code> before sending a patch.</p><div class=edit-meta><br></div><nav class=pagination><a class="nav nav-prev" href=/docs/Tools/ title=Tools><i class="fas fa-arrow-left" aria-hidden=true></i>Prev - Tools</a>
<a class="nav nav-next" href=/docs/Tools/mlir-reduce/ title="MLIR Reduce">Next - MLIR Reduce <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://mlir.llvm.org/>Home</a></li><li><a href=/pubs/>MLIR Related Publications</a></li><li><a href=/talks/>Talks</a></li><li><a href=/users/>Users of MLIR</a></li><li class=has-sub-menu><a href=/getting_started/>Getting Started<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=/getting_started/Debugging/>Debugging Tips</a></li><li><a href=/getting_started/Faq/>FAQ</a></li><li><a href=/getting_started/Contributing/>How to Contribute</a></li><li><a href=/getting_started/DeveloperGuide/>Developer Guide</a></li><li><a href=/getting_started/openprojects/>Open Projects</a></li><li><a href=/getting_started/Glossary/>Glossary</a></li><li><a href=/getting_started/TestingGuide/>Testing Guide</a></li></ul></li><li class="parent has-sub-menu"><a href=/docs/>Code Documentation<span class="mark opened">-</span></a><ul class=sub-menu><li class=has-sub-menu><a href=/docs/Bindings/>Bindings<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=/docs/Bindings/Python/>MLIR Python Bindings</a></li></ul></li><li class="parent has-sub-menu"><a href=/docs/Tools/>Tools<span class="mark opened">-</span></a><ul class=sub-menu><li class=active><a href=/docs/Tools/MLIRLSP/>MLIR : Language Server Protocol</a></li><li><a href=/docs/Tools/mlir-reduce/>MLIR Reduce</a></li></ul></li><li><a href=/docs/BufferDeallocationInternals/>Buffer Deallocation - Internals</a></li><li><a href=/docs/Bufferization/>Bufferization</a></li><li><a href=/docs/DataLayout/>Data Layout Modeling</a></li><li><a href=/docs/DebugActions/>Debug Actions</a></li><li><a href=/docs/AttributesAndTypes/>Defining Dialect Attributes and Types</a></li><li><a href=/docs/DefiningDialects/>Defining Dialects</a></li><li><a href=/docs/Diagnostics/>Diagnostic Infrastructure</a></li><li><a href=/docs/DialectConversion/>Dialect Conversion</a></li><li class=has-sub-menu><a href=/docs/Dialects/>Dialects<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=/docs/Dialects/OpenACCDialect/>'acc' Dialect</a></li><li><a href=/docs/Dialects/Affine/>'affine' Dialect</a></li><li><a href=/docs/Dialects/AMX/>'amx' Dialect</a></li><li><a href=/docs/Dialects/ArithmeticOps/>'arith' Dialect</a></li><li><a href=/docs/Dialects/ArmNeon/>'arm_neon' Dialect</a></li><li><a href=/docs/Dialects/ArmSVE/>'arm_sve' Dialect</a></li><li><a href=/docs/Dialects/AsyncDialect/>'async' Dialect</a></li><li><a href=/docs/Dialects/BufferizationOps/>'bufferization' Dialect</a></li><li><a href=/docs/Dialects/ControlFlowDialect/>'cf' Dialect</a></li><li><a href=/docs/Dialects/ComplexOps/>'complex' Dialect</a></li><li><a href=/docs/Dialects/DLTIDialect/>'dlti' Dialect</a></li><li><a href=/docs/Dialects/EmitC/>'emitc' Dialect</a></li><li><a href=/docs/Dialects/Func/>'func' Dialect</a></li><li><a href=/docs/Dialects/GPU/>'gpu' Dialect</a></li><li class=has-sub-menu><a href=/docs/Dialects/Linalg/>'linalg' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=/docs/Dialects/Linalg/OpDSL/>Linalg OpDSL</a></li></ul></li><li><a href=/docs/Dialects/LLVM/>'llvm' Dialect</a></li><li><a href=/docs/Dialects/MathOps/>'math' Dialect</a></li><li><a href=/docs/Dialects/MemRef/>'memref' Dialect</a></li><li><a href=/docs/Dialects/MLProgramOps/>'ml_program' Dialect</a></li><li><a href=/docs/Dialects/NVGPU/>'nvgpu' Dialect</a></li><li><a href=/docs/Dialects/NVVMDialect/>'nvvm' Dialect</a></li><li><a href=/docs/Dialects/OpenMPDialect/>'omp' Dialect</a></li><li><a href=/docs/Dialects/PDLOps/>'pdl' Dialect</a></li><li><a href=/docs/Dialects/PDLInterpOps/>'pdl_interp' Dialect</a></li><li><a href=/docs/Dialects/QuantDialect/>'quant' Dialect</a></li><li><a href=/docs/Dialects/ROCDLDialect/>'rocdl' Dialect</a></li><li><a href=/docs/Dialects/SCFDialect/>'scf' Dialect</a></li><li><a href=/docs/Dialects/ShapeDialect/>'shape' Dialect</a></li><li><a href=/docs/Dialects/SparseTensorOps/>'sparse_tensor' Dialect</a></li><li><a href=/docs/Dialects/SPIR-V/>'spv' Dialect</a></li><li><a href=/docs/Dialects/TensorOps/>'tensor' Dialect</a></li><li><a href=/docs/Dialects/Vector/>'vector' Dialect</a></li><li><a href=/docs/Dialects/X86Vector/>'x86vector' Dialect</a></li><li><a href=/docs/Dialects/Builtin/>Builtin Dialect</a></li><li><a href=/docs/Dialects/TOSA/>Tensor Operator Set Architecture (TOSA) Dialect</a></li><li><a href=/docs/Dialects/Transform/>Transform Dialect</a></li></ul></li><li><a href=/docs/ExtensibleDialects/>Extensible dialects</a></li><li><a href=/docs/Interfaces/>Interfaces</a></li><li><a href=/docs/TargetLLVMIR/>LLVM IR Target</a></li><li><a href=/docs/CAPI/>MLIR C API</a></li><li><a href=/docs/LangRef/>MLIR Language Reference</a></li><li><a href=/docs/Canonicalization/>Operation Canonicalization</a></li><li><a href=/docs/OpDefinitions/>Operation Definition Specification (ODS)</a></li><li><a href=/docs/PassManagement/>Pass Infrastructure</a></li><li><a href=/docs/Passes/>Passes</a></li><li><a href=/docs/PatternRewriter/>Pattern Rewriting : Generic DAG-to-DAG Rewriting</a></li><li><a href=/docs/PDLL/>PDLL - PDL Language</a></li><li><a href=/docs/Quantization/>Quantization</a></li><li class=has-sub-menu><a href=/docs/Rationale/>Rationale<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=/docs/Rationale/RationaleGenericDAGRewriter/>Generic DAG Rewriter Infrastructure Rationale</a></li><li><a href=/docs/Rationale/RationaleLinalgDialect/>Linalg Dialect Rationale: The Case For Compiler-Friendly Custom Operations</a></li><li><a href=/docs/Rationale/Rationale/>MLIR Rationale</a></li><li><a href=/docs/Rationale/MLIRForGraphAlgorithms/>MLIR: Incremental Application to Graph Algorithms in ML Frameworks</a></li><li><a href=/docs/Rationale/RationaleSimplifiedPolyhedralForm/>MLIR: The case for a simplified polyhedral form</a></li><li><a href=/docs/Rationale/UsageOfConst/>Usage of 'const' in MLIR, for core IR types</a></li></ul></li><li><a href=/docs/ShapeInference/>Shape Inference</a></li><li><a href=/docs/SPIRVToLLVMDialectConversion/>SPIR-V Dialect to LLVM Dialect conversion manual</a></li><li><a href=/docs/SymbolsAndSymbolTables/>Symbols and Symbol Tables</a></li><li><a href=/docs/DeclarativeRewrites/>Table-driven Declarative Rewrite Rule (DRR)</a></li><li><a href=/docs/Traits/>Traits</a></li><li class=has-sub-menu><a href=/docs/Tutorials/>Tutorials<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=/docs/Tutorials/CreatingADialect/>Creating a Dialect</a></li><li><a href=/docs/Tutorials/QuickstartRewrites/>Quickstart tutorial to adding MLIR graph rewrite</a></li><li class=has-sub-menu><a href=/docs/Tutorials/Toy/>Toy Tutorial<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=/docs/Tutorials/Toy/Ch-1/>Chapter 1: Toy Language and AST</a></li><li><a href=/docs/Tutorials/Toy/Ch-2/>Chapter 2: Emitting Basic MLIR</a></li><li><a href=/docs/Tutorials/Toy/Ch-3/>Chapter 3: High-level Language-Specific Analysis and Transformation</a></li><li><a href=/docs/Tutorials/Toy/Ch-4/>Chapter 4: Enabling Generic Transformation with Interfaces</a></li><li><a href=/docs/Tutorials/Toy/Ch-5/>Chapter 5: Partial Lowering to Lower-Level Dialects for Optimization</a></li><li><a href=/docs/Tutorials/Toy/Ch-6/>Chapter 6: Lowering to LLVM and CodeGeneration</a></li><li><a href=/docs/Tutorials/Toy/Ch-7/>Chapter 7: Adding a Composite Type to Toy</a></li></ul></li><li><a href=/docs/Tutorials/UnderstandingTheIRStructure/>Understanding the IR Structure</a></li><li><a href=/docs/Tutorials/DataFlowAnalysis/>Writing DataFlow Analyses in MLIR</a></li></ul></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i><i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>